# 下班时间管理应用

这是一个帮助你管理加班时间和计算预计下班时间的Web应用。

## 功能特点

- 📊 **自动数据同步**：页面加载时自动从Google表格获取数据
- ⏰ **智能计算**：根据本月已加班时间和剩余工作日，计算每日需要的加班时间
- 📱 **响应式设计**：支持桌面和移动设备
- 🔄 **实时更新**：每30分钟自动刷新数据
- 💾 **本地缓存**：支持离线查看历史数据

## 设置步骤

### 1. 准备Google表格

确保你的Google表格包含以下列：
- **Date**：日期（格式：2025/06/02）
- **CheckIn**：签到时间（格式：9:00:00）
- **CheckOut**：签出时间（格式：19:25）
- **OvertimeHours**：加班小时数（格式：1.42）

### 2. 部署Google Apps Script

1. 打开 [Google Apps Script](https://script.google.com/)
2. 创建新项目
3. 将 `gas-optimized.js` 文件中的代码复制到脚本编辑器
4. 修改 `SHEET_NAME` 常量为你的工作表名称
5. 修改 `REQUIRED_OVERTIME_HOURS` 为你的月度加班目标
6. 部署为Web应用：
   - 点击"部署" > "新建部署"
   - 类型选择"Web应用"
   - 执行身份选择你的账户
   - 访问权限选择"任何人"
   - 点击"部署"
   - 复制Web应用URL

### 3. 配置前端应用

1. 启动应用：`npm start`
2. 打开浏览器访问 `http://localhost:3000`
3. 点击"设置"按钮
4. 填入Google Apps Script Web App URL
5. 设置正常下班时间（默认18:00）
6. 设置月度加班目标（默认29小时）
7. 点击"保存设置"
8. 点击"测试连接"验证配置

## 使用方法

### 自动数据获取
- 页面加载时会自动从Google表格获取数据
- 每30分钟自动刷新一次
- 切换回浏览器标签页时也会自动刷新

### 手动操作
- **下班打卡**：记录当前时间为下班时间，自动计算加班时长
- **刷新数据**：点击🔄按钮手动刷新数据
- **查看历史**：查看最近5次的打卡记录

### 数据显示
- **今日预计下班时间**：根据剩余加班时间和工作日计算
- **本月已加班**：显示本月累计加班时长
- **剩余加班**：显示还需要完成的加班时长
- **状态提示**：显示每日需要加班的时长和剩余工作日

## 数据格式说明

### Google表格数据示例
```
Date        CheckIn   CheckOut  OvertimeHours
2025/06/02  9:00:00   19:25     1.42
2025/06/03  9:00:00   20:00     2.00
2025/06/04  9:00:00   19:48     1.80
```

### 应用内数据格式
应用会自动将Google表格数据转换为内部格式：
```json
{
  "date": "2025-06-02",
  "time": "19:25",
  "overtime": 1.42,
  "synced": true
}
```

## 故障排除

### 数据无法加载
1. 检查Google Apps Script URL是否正确
2. 确认Google Apps Script已正确部署
3. 检查Google表格权限设置
4. 查看浏览器控制台错误信息

### 计算结果不准确
1. 确认Google表格数据格式正确
2. 检查月度加班目标设置
3. 验证正常下班时间设置

### 连接测试失败
1. 确认网络连接正常
2. 检查Google Apps Script服务状态
3. 尝试重新部署Google Apps Script

## 技术特点

- **前端**：原生HTML/CSS/JavaScript，无需额外框架
- **后端**：Google Apps Script，免费且稳定
- **数据存储**：Google Sheets + 本地localStorage
- **跨域处理**：支持CORS，确保数据同步正常

## 更新日志

### v1.1.0
- ✨ 新增页面加载时自动获取数据
- 🔧 优化数据解析逻辑，支持多种日期格式
- 📊 改进预计下班时间计算算法
- 🔄 添加手动刷新功能
- 📱 优化移动端显示效果

### v1.0.0
- 🎉 初始版本发布
- ⏰ 基础打卡功能
- 📊 加班时间统计
- 🔗 Google Sheets集成
